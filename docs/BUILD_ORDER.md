# æµè§ˆå™¨è§†é¢‘ç¼–è¾‘å™¨æ„å»ºé¡ºåº

## æ¶æ„ä¾èµ–å…³ç³»å›¾

```
RFC-003: æµè§ˆå™¨è¿è¡Œæ—¶ (é€šç”¨åŸºç¡€å±‚)
   â”œâ”€â”€ ffmpeg.wasm åç«¯
   â”œâ”€â”€ wasm-vips åç«¯ (å›¾åƒå¤„ç†)
   â””â”€â”€ DSL æ‰§è¡Œå™¨
        â†“
RFC-009: æµè§ˆå™¨é¢„è§ˆè¿è¡Œæ—¶ (é¢„è§ˆå±‚ï¼ŒåŸºäºRFC-003)
   â”œâ”€â”€ ä¼˜åŒ–çš„é¢„è§ˆAPI
   â”œâ”€â”€ æ–‡ä»¶å¤§å°è‡ªåŠ¨è·¯ç”±
   â””â”€â”€ Web Workeré›†æˆ
        â†“
RFC-014: Web Video Editor (åº”ç”¨å±‚ - ä½¿ç”¨RFC-009è¿›è¡Œé¢„è§ˆ)
   â”œâ”€â”€ Timeline UI (@xzdarcy/react-timeline-editor - MIT)
   â”œâ”€â”€ Previewç»„ä»¶ (ä½¿ç”¨RFC-009)
   â”œâ”€â”€ Inspectorç»„ä»¶
   â””â”€â”€ Toolbarç»„ä»¶
        â†“
RFC-015: Web Image Editor (åº”ç”¨å±‚ - ä½¿ç”¨RFC-003çš„wasm-vips)
   â”œâ”€â”€ Canvas Editor
   â”œâ”€â”€ Layer System
   â””â”€â”€ Filter Panel
```

## RFC-008 vs RFC-014 çš„åŒºåˆ«

### RFC-008: Affect å¿«é€Ÿè§†é¢‘ç¼–è¾‘å™¨

- **ç›®æ ‡**: æœåŠ¡å™¨ç«¯è§†é¢‘ç¼–è¾‘å™¨ (Bun + Elysia + React)
- **é¢„è§ˆ**: ä½¿ç”¨RFC-009æµè§ˆå™¨é¢„è§ˆè¿è¡Œæ—¶ï¼ˆå°æ–‡ä»¶ï¼‰
- **æ¸²æŸ“**: æœåŠ¡å™¨ç«¯æœ€ç»ˆæ¸²æŸ“ï¼ˆå¤§æ–‡ä»¶ï¼‰
- **æ¶æ„**: å®¢æˆ·ç«¯-æœåŠ¡å™¨æ··åˆæ¶æ„

### RFC-014: Web Video Editor

- **ç›®æ ‡**: **çº¯æµè§ˆå™¨**è§†é¢‘ç¼–è¾‘å™¨ï¼ˆæ— æœåŠ¡å™¨ä¾èµ–ï¼‰
- **é¢„è§ˆ**: å®æ—¶æµè§ˆå™¨é¢„è§ˆï¼ˆä½¿ç”¨RFC-009ï¼‰
- **æ¸²æŸ“**: æµè§ˆå™¨ç«¯æ¸²æŸ“ï¼ˆffmpeg.wasmï¼‰
- **æ¶æ„**: çº¯å‰ç«¯æ¶æ„

**å…³ç³»**: RFC-014æ˜¯RFC-008çš„çº¯æµè§ˆå™¨ç‰ˆæœ¬ï¼Œä¸¤è€…å…±äº«RFC-009çš„é¢„è§ˆåŠŸèƒ½

## æŠ€æœ¯é€‰æ‹©ï¼šä¸ºä»€ä¹ˆä¸ä½¿ç”¨Remotionï¼Ÿ

| ç‰¹æ€§         | æœ¬æ–¹æ¡ˆ (ffmpeg.wasm + NLE)  | Remotion                     |
| :----------- | :-------------------------- | :--------------------------- |
| **License**  | âœ… **MIT**                  | âŒ **Polyform** (å•†ä¸šéœ€ä»˜è´¹) |
| **å¤„ç†æ–¹å¼** | Bitstreamæ“ä½œï¼ˆæ— æŸï¼Œå¿«é€Ÿï¼‰ | Frameæ¸²æŸ“ï¼ˆæ…¢ï¼Œå¿…é¡»é‡ç¼–ç ï¼‰  |
| **é€‚ç”¨åœºæ™¯** | NLEå‰ªè¾‘å·¥å…·ï¼ˆç±»ä¼¼Premiereï¼‰ | ç¨‹åºåŒ–è§†é¢‘ç”Ÿæˆ               |

**æ ¸å¿ƒåŸå› **ï¼šæˆ‘ä»¬éœ€è¦MITè®¸å¯è¯ï¼Œä¸”NLEåœºæ™¯æ›´é€‚åˆffmpeg.wasm

## ä¾èµ–åŒ…è®¸å¯è¯éªŒè¯

### æ ¸å¿ƒä¾èµ–ï¼ˆå…¨éƒ¨å¼€æºå‹å¥½ï¼‰

| åŒ…å                             | è®¸å¯è¯ | æ¥æº                                                       |
| :------------------------------- | :----: | :--------------------------------------------------------- |
| `@ffmpeg/ffmpeg`                 |  MIT   | [npm](https://www.npmjs.com/package/@ffmpeg/ffmpeg)        |
| `@xzdarcy/react-timeline-editor` |  MIT   | [GitHub](https://github.com/xzdarcy/react-timeline-editor) |
| `zustand`                        |  MIT   | [GitHub](https://github.com/pmndrs/zustand)                |
| `lucide-react`                   |  ISC   | [Lucide](https://lucide.dev/license)                       |
| `react`                          |  MIT   | [React](https://react.dev)                                 |
| `tailwindcss`                    |  MIT   | [Tailwind](https://tailwindcss.com)                        |

**æ³¨æ„**: ISCè®¸å¯è¯æ˜¯MITå…¼å®¹çš„å¼€æºè®¸å¯è¯ï¼Œå¯ä»¥å®‰å…¨ä½¿ç”¨

## æ­£ç¡®çš„æ„å»ºé¡ºåº

### ç¬¬1æ­¥ï¼šå®ç°RFC-003 æµè§ˆå™¨è¿è¡Œæ—¶ï¼ˆåŸºç¡€å±‚ï¼‰

```
packages/@affectjs/affect-browser/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                    # ä¸»å…¥å£
â”‚   â”œâ”€â”€ runtime.ts                  # æµè§ˆå™¨è¿è¡Œæ—¶
â”‚   â”œâ”€â”€ router.ts                   # åª’ä½“ç±»å‹è·¯ç”±
â”‚   â””â”€â”€ backends/
â”‚       â”œâ”€â”€ ffmpeg-wasm.ts         # ffmpeg.wasm åç«¯
â”‚       â””â”€â”€ wasm-vips.ts           # wasm-vips åç«¯ï¼ˆå›¾åƒï¼‰
```

**å…³é”®åŠŸèƒ½**ï¼š

- ffmpeg.wasmé›†æˆå’Œå°è£…
- wasm-vipsé›†æˆï¼ˆå›¾åƒå¤„ç†ï¼‰
- DSLåˆ°FFmpegå‘½ä»¤çš„è½¬æ¢
- ç»Ÿä¸€çš„æ‰§è¡ŒAPI

### ç¬¬2æ­¥ï¼šå®ç°RFC-009 æµè§ˆå™¨é¢„è§ˆè¿è¡Œæ—¶ï¼ˆé¢„è§ˆå±‚ï¼‰

```
packages/@affectjs/affect-browser/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ preview/
â”‚   â”‚   â”œâ”€â”€ preview-runtime.ts     # é¢„è§ˆè¿è¡Œæ—¶
â”‚   â”‚   â”œâ”€â”€ file-router.ts         # æ–‡ä»¶å¤§å°è·¯ç”±
â”‚   â”‚   â””â”€â”€ hooks.ts               # React hooks (usePreview)
```

**å…³é”®åŠŸèƒ½**ï¼š

- åŸºäºRFC-003çš„ä¼˜åŒ–é¢„è§ˆAPI
- è‡ªåŠ¨æ–‡ä»¶å¤§å°è·¯ç”±ï¼ˆæµè§ˆå™¨ vs æœåŠ¡å™¨ï¼‰
- React Hooksé›†æˆ
- è¿›åº¦å›è°ƒå’Œé”™è¯¯å¤„ç†

### ç¬¬3æ­¥ï¼šå®ç°RFC-014 Web Video Editorï¼ˆè§†é¢‘ç¼–è¾‘å™¨ï¼‰

```
packages/@affectjs/editor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Timeline/              # æ—¶é—´çº¿UI
â”‚   â”‚   â”œâ”€â”€ Preview/               # é¢„è§ˆç»„ä»¶ï¼ˆä½¿ç”¨RFC-009ï¼‰
â”‚   â”‚   â”œâ”€â”€ Inspector/             # å±æ€§æ£€æŸ¥å™¨
â”‚   â”‚   â””â”€â”€ Toolbar/               # å·¥å…·æ 
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ ffmpeg/
â”‚   â”‚       â””â”€â”€ ffmpeg.ts          # ä½¿ç”¨ @affectjs/affect-browser
â”‚   â””â”€â”€ adapters/
â”‚       â”œâ”€â”€ BrowserAdapter.ts      # æµè§ˆå™¨é€‚é…å™¨
â”‚       â””â”€â”€ ApiAdapter.ts          # å¯é€‰çš„æœåŠ¡å™¨é€‚é…å™¨
```

**å…³é”®åŠŸèƒ½**ï¼š

- Timelineç»„ä»¶ï¼ˆä½¿ç”¨@xzdarcy/react-timeline-editorï¼‰
- Previewç»„ä»¶ï¼ˆä½¿ç”¨RFC-009è¿›è¡Œå®æ—¶é¢„è§ˆï¼‰
- DSLç”Ÿæˆå™¨ï¼ˆç”¨æˆ·æ“ä½œ â†’ Affect DSLï¼‰
- æ–‡ä»¶å¯¼å…¥/å¯¼å‡º

### ç¬¬4æ­¥ï¼šå®ç°RFC-015 Web Image Editorï¼ˆå›¾åƒç¼–è¾‘å™¨ï¼‰

```
packages/@affectjs/image-editor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Canvas/                # Canvasç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ Layers/                # å›¾å±‚ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ Filters/               # æ»¤é•œé¢æ¿
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ vips/
â”‚           â””â”€â”€ vips.ts            # ä½¿ç”¨ @affectjs/affect-browser (wasm-vips)
```

## å½“å‰å®æ–½çŠ¶æ€

### âœ… å·²å®Œæˆ

1. RFC-014å’ŒRFC-015æ–‡æ¡£å·²åˆ›å»º
2. `@affectjs/editor`åŒ…å·²åˆå§‹åŒ–
3. åŸºç¡€Timelineç»„ä»¶å·²å®ç°
4. Previewå’ŒInspectorç»„ä»¶å·²åˆ›å»º
5. BrowserAdapterå·²éƒ¨åˆ†å®ç°

### ğŸ”„ è¿›è¡Œä¸­

1. å®Œå–„FFmpegæœåŠ¡å°è£…
2. éªŒè¯æ‰€æœ‰ä¾èµ–åŒ…çš„è®¸å¯è¯

### â³ å¾…å®Œæˆ

1. å®Œæ•´å®ç°RFC-003ï¼ˆæµè§ˆå™¨è¿è¡Œæ—¶ï¼‰
2. å®Œæ•´å®ç°RFC-009ï¼ˆé¢„è§ˆè¿è¡Œæ—¶ï¼‰
3. é›†æˆTimelineã€Previewã€Inspectorç»„ä»¶
4. å®ç°æ–‡ä»¶å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
5. ç«¯åˆ°ç«¯æµ‹è¯•

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ä¼˜å…ˆçº§1ï¼šå®Œå–„RFC-003å®ç°

- [ ] å®Œå–„ffmpeg.wasmå°è£…
- [ ] å®ç°DSLåˆ°FFmpegå‘½ä»¤çš„å®Œæ•´è½¬æ¢
- [ ] æ·»åŠ è¿›åº¦å›è°ƒ
- [ ] æ·»åŠ é”™è¯¯å¤„ç†

### ä¼˜å…ˆçº§2ï¼šå®ç°RFC-009é¢„è§ˆåŠŸèƒ½

- [ ] åˆ›å»ºé¢„è§ˆè¿è¡Œæ—¶API
- [ ] å®ç°æ–‡ä»¶å¤§å°è·¯ç”±é€»è¾‘
- [ ] åˆ›å»ºReact hooks (usePreview)
- [ ] é›†æˆWeb Worker

### ä¼˜å…ˆçº§3ï¼šå®Œå–„RFC-014ç¼–è¾‘å™¨

- [ ] é›†æˆæ‰€æœ‰ç»„ä»¶
- [ ] å®ç°æ–‡ä»¶å¯¼å…¥
- [ ] å®ç°å¯¼å‡ºåŠŸèƒ½
- [ ] æ·»åŠ é”®ç›˜å¿«æ·é”®
- [ ] æ€§èƒ½ä¼˜åŒ–

## å‚è€ƒ

- [RFC-003: æµè§ˆå™¨è¿è¡Œæ—¶](./docs/rfc/0003-browser-runtime.md)
- [RFC-009: æµè§ˆå™¨é¢„è§ˆè¿è¡Œæ—¶](./docs/rfc/0009-browser-preview-runtime.md)
- [RFC-014: Web Video Editor](./docs/rfc/0014-video-editor-wasm-react.md)
- [RFC-015: Web Image Editor](./docs/rfc/0015-image-editor-wasm-react.md)
